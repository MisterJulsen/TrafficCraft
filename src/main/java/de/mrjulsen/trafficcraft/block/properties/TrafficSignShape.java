package de.mrjulsen.trafficcraft.block.properties;

import java.util.Arrays;
import java.util.stream.IntStream;

import com.mojang.blaze3d.platform.NativeImage;

import de.mrjulsen.trafficcraft.ModMain;
import de.mrjulsen.trafficcraft.util.Utils;
import net.minecraft.client.renderer.texture.DynamicTexture;
import net.minecraft.resources.ResourceLocation;
import net.minecraft.util.Mth;
import net.minecraft.util.StringRepresentable;

public enum TrafficSignShape implements StringRepresentable {
    CIRCLE("circle", 0, new int[] {0,1,2,3,4,5,6,7,8,9,22,23,24,25,26,27,28,29,30,31,65536,65537,65538,65539,65540,65541,65542,65543,65544,65545,65558,65559,65560,65561,65562,65563,65564,65565,65566,65567,131072,131073,131074,131075,131076,131077,131098,131099,131100,131101,131102,131103,196608,196609,196610,196611,196612,196613,196634,196635,196636,196637,196638,196639,262144,262145,262146,262147,262172,262173,262174,262175,327680,327681,327682,327683,327708,327709,327710,327711,393216,393217,393246,393247,458752,458753,458782,458783,524288,524289,524318,524319,589824,589825,589854,589855,1441792,1441793,1441822,1441823,1507328,1507329,1507358,1507359,1572864,1572865,1572894,1572895,1638400,1638401,1638430,1638431,1703936,1703937,1703938,1703939,1703964,1703965,1703966,1703967,1769472,1769473,1769474,1769475,1769500,1769501,1769502,1769503,1835008,1835009,1835010,1835011,1835012,1835013,1835034,1835035,1835036,1835037,1835038,1835039,1900544,1900545,1900546,1900547,1900548,1900549,1900570,1900571,1900572,1900573,1900574,1900575,1966080,1966081,1966082,1966083,1966084,1966085,1966086,1966087,1966088,1966089,1966102,1966103,1966104,1966105,1966106,1966107,1966108,1966109,1966110,1966111,2031616,2031617,2031618,2031619,2031620,2031621,2031622,2031623,2031624,2031625,2031638,2031639,2031640,2031641,2031642,2031643,2031644,2031645,2031646,2031647}),
	SQUARE("square", 1, new int[] {}),
	TRIANGLE("triangle", 2, new int[] {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,30,31,65536,65537,65538,65539,65540,65541,65542,65543,65544,65545,65546,65547,65548,65549,65550,65551,65552,65553,65554,65555,65556,65557,65558,65559,65566,65567,131072,131073,131074,131075,131076,131077,131078,131079,131080,131081,131082,131083,131084,131085,131086,131087,131088,131089,131090,131091,196608,196609,196610,196611,196612,196613,196614,196615,196616,196617,196618,196619,196620,196621,196622,196623,196624,196625,196626,196627,262144,262145,262146,262147,262148,262149,262150,262151,262152,262153,262154,262155,262156,262157,262158,262159,327680,327681,327682,327683,327684,327685,327686,327687,327688,327689,327690,327691,327692,327693,327694,327695,393216,393217,393218,393219,393220,393221,393222,393223,393224,393225,393226,393227,458752,458753,458754,458755,458756,458757,458758,458759,458760,458761,458762,458763,524288,524289,524290,524291,524292,524293,524294,524295,589824,589825,589826,589827,589828,589829,589830,589831,655360,655361,655362,655363,720896,720897,720898,720899,1310720,1310721,1310722,1310723,1376256,1376257,1376258,1376259,1441792,1441793,1441794,1441795,1441796,1441797,1441798,1441799,1507328,1507329,1507330,1507331,1507332,1507333,1507334,1507335,1572864,1572865,1572866,1572867,1572868,1572869,1572870,1572871,1572872,1572873,1572874,1572875,1638400,1638401,1638402,1638403,1638404,1638405,1638406,1638407,1638408,1638409,1638410,1638411,1703936,1703937,1703938,1703939,1703940,1703941,1703942,1703943,1703944,1703945,1703946,1703947,1703948,1703949,1703950,1703951,1769472,1769473,1769474,1769475,1769476,1769477,1769478,1769479,1769480,1769481,1769482,1769483,1769484,1769485,1769486,1769487,1835008,1835009,1835010,1835011,1835012,1835013,1835014,1835015,1835016,1835017,1835018,1835019,1835020,1835021,1835022,1835023,1835024,1835025,1835026,1835027,1900544,1900545,1900546,1900547,1900548,1900549,1900550,1900551,1900552,1900553,1900554,1900555,1900556,1900557,1900558,1900559,1900560,1900561,1900562,1900563,1966080,1966081,1966082,1966083,1966084,1966085,1966086,1966087,1966088,1966089,1966090,1966091,1966092,1966093,1966094,1966095,1966096,1966097,1966098,1966099,1966100,1966101,1966102,1966103,1966110,1966111,2031616,2031617,2031618,2031619,2031620,2031621,2031622,2031623,2031624,2031625,2031626,2031627,2031628,2031629,2031630,2031631,2031632,2031633,2031634,2031635,2031636,2031637,2031638,2031639,2031646,2031647}),
	DIAMOND("diamond", 3, new int[] {0,1,2,3,4,5,6,7,8,9,10,11,12,13,18,19,20,21,22,23,24,25,26,27,28,29,30,31,65536,65537,65538,65539,65540,65541,65542,65543,65544,65545,65546,65547,65548,65549,65554,65555,65556,65557,65558,65559,65560,65561,65562,65563,65564,65565,65566,65567,131072,131073,131074,131075,131076,131077,131078,131079,131080,131081,131082,131083,131092,131093,131094,131095,131096,131097,131098,131099,131100,131101,131102,131103,196608,196609,196610,196611,196612,196613,196614,196615,196616,196617,196618,196619,196628,196629,196630,196631,196632,196633,196634,196635,196636,196637,196638,196639,262144,262145,262146,262147,262148,262149,262150,262151,262152,262153,262166,262167,262168,262169,262170,262171,262172,262173,262174,262175,327680,327681,327682,327683,327684,327685,327686,327687,327688,327689,327702,327703,327704,327705,327706,327707,327708,327709,327710,327711,393216,393217,393218,393219,393220,393221,393222,393223,393240,393241,393242,393243,393244,393245,393246,393247,458752,458753,458754,458755,458756,458757,458758,458759,458776,458777,458778,458779,458780,458781,458782,458783,524288,524289,524290,524291,524292,524293,524314,524315,524316,524317,524318,524319,589824,589825,589826,589827,589828,589829,589850,589851,589852,589853,589854,589855,655360,655361,655362,655363,655388,655389,655390,655391,720896,720897,720898,720899,720924,720925,720926,720927,786432,786433,786462,786463,851968,851969,851998,851999,1179648,1179649,1179678,1179679,1245184,1245185,1245214,1245215,1310720,1310721,1310722,1310723,1310748,1310749,1310750,1310751,1376256,1376257,1376258,1376259,1376284,1376285,1376286,1376287,1441792,1441793,1441794,1441795,1441796,1441797,1441818,1441819,1441820,1441821,1441822,1441823,1507328,1507329,1507330,1507331,1507332,1507333,1507354,1507355,1507356,1507357,1507358,1507359,1572864,1572865,1572866,1572867,1572868,1572869,1572870,1572871,1572888,1572889,1572890,1572891,1572892,1572893,1572894,1572895,1638400,1638401,1638402,1638403,1638404,1638405,1638406,1638407,1638424,1638425,1638426,1638427,1638428,1638429,1638430,1638431,1703936,1703937,1703938,1703939,1703940,1703941,1703942,1703943,1703944,1703945,1703958,1703959,1703960,1703961,1703962,1703963,1703964,1703965,1703966,1703967,1769472,1769473,1769474,1769475,1769476,1769477,1769478,1769479,1769480,1769481,1769494,1769495,1769496,1769497,1769498,1769499,1769500,1769501,1769502,1769503,1835008,1835009,1835010,1835011,1835012,1835013,1835014,1835015,1835016,1835017,1835018,1835019,1835028,1835029,1835030,1835031,1835032,1835033,1835034,1835035,1835036,1835037,1835038,1835039,1900544,1900545,1900546,1900547,1900548,1900549,1900550,1900551,1900552,1900553,1900554,1900555,1900564,1900565,1900566,1900567,1900568,1900569,1900570,1900571,1900572,1900573,1900574,1900575,1966080,1966081,1966082,1966083,1966084,1966085,1966086,1966087,1966088,1966089,1966090,1966091,1966092,1966093,1966098,1966099,1966100,1966101,1966102,1966103,1966104,1966105,1966106,1966107,1966108,1966109,1966110,1966111,2031616,2031617,2031618,2031619,2031620,2031621,2031622,2031623,2031624,2031625,2031626,2031627,2031628,2031629,2031634,2031635,2031636,2031637,2031638,2031639,2031640,2031641,2031642,2031643,2031644,2031645,2031646,2031647}),
	RECTANGLE("rectangle", 4, new int[] {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,65536,65537,65538,65539,65540,65541,65542,65543,65544,65545,65546,65547,65548,65549,65550,65551,65552,65553,65554,65555,65556,65557,65558,65559,65560,65561,65562,65563,65564,65565,65566,65567,131072,131073,131074,131075,131076,131077,131078,131079,131080,131081,131082,131083,131084,131085,131086,131087,131088,131089,131090,131091,131092,131093,131094,131095,131096,131097,131098,131099,131100,131101,131102,131103,196608,196609,196610,196611,196612,196613,196614,196615,196616,196617,196618,196619,196620,196621,196622,196623,196624,196625,196626,196627,196628,196629,196630,196631,196632,196633,196634,196635,196636,196637,196638,196639,1835008,1835009,1835010,1835011,1835012,1835013,1835014,1835015,1835016,1835017,1835018,1835019,1835020,1835021,1835022,1835023,1835024,1835025,1835026,1835027,1835028,1835029,1835030,1835031,1835032,1835033,1835034,1835035,1835036,1835037,1835038,1835039,1900544,1900545,1900546,1900547,1900548,1900549,1900550,1900551,1900552,1900553,1900554,1900555,1900556,1900557,1900558,1900559,1900560,1900561,1900562,1900563,1900564,1900565,1900566,1900567,1900568,1900569,1900570,1900571,1900572,1900573,1900574,1900575,1966080,1966081,1966082,1966083,1966084,1966085,1966086,1966087,1966088,1966089,1966090,1966091,1966092,1966093,1966094,1966095,1966096,1966097,1966098,1966099,1966100,1966101,1966102,1966103,1966104,1966105,1966106,1966107,1966108,1966109,1966110,1966111,2031616,2031617,2031618,2031619,2031620,2031621,2031622,2031623,2031624,2031625,2031626,2031627,2031628,2031629,2031630,2031631,2031632,2031633,2031634,2031635,2031636,2031637,2031638,2031639,2031640,2031641,2031642,2031643,2031644,2031645,2031646,2031647}),	
	MISC("misc", 5, new int[] {});
	
	private String shape;
	private int index;
	private int[] invalidPixels;

	public static final int MAX_WIDTH = 32;
	public static final int MAX_HEIGHT = 32;
	private static final int TRANSPARENCY_COLOR_PRIMARY = 0xFFE9E9E9;
	private static final int TRANSPARENCY_COLOR_SECONDARY = 0xFFD9D9D9;

	private static final DynamicTexture[] SHAPE_TEXTURES = Arrays.stream(values()).map(v -> {
		NativeImage image = new NativeImage(NativeImage.Format.RGBA, MAX_WIDTH, MAX_HEIGHT, false);
		for (int x = 0; x < image.getWidth(); x++) {
			for (int y = 0; y < image.getHeight(); y++) {
				if (v.isPixelValid(x, y)) {
					image.setPixelRGBA(x, y, x % 2 == 0 ? (y % 2 == 0 ? TRANSPARENCY_COLOR_PRIMARY : TRANSPARENCY_COLOR_SECONDARY) : (y % 2 == 0 ? TRANSPARENCY_COLOR_SECONDARY : TRANSPARENCY_COLOR_PRIMARY));
				}
			}
		}
		return new DynamicTexture(image);
	}).toArray(DynamicTexture[]::new);
	
	private TrafficSignShape(String shape, int index, int[] invalidPixels) {
		this.shape = shape;
		this.index = index;
		this.invalidPixels = invalidPixels;
	}
	
	public String getShape() {
		return this.shape;
	}

	public int getIndex() {
		return this.index;
	}

	public String getTranslationKey() {
		return String.format("gui.trafficcraft.signpicker.tab.%s", shape);
	}

	public boolean isPixelValid(int x, int y) {
		return !IntStream.of(invalidPixels).anyMatch(a -> a == Utils.coordsToInt((byte)Mth.clamp(x, 0, MAX_WIDTH), (byte)Mth.clamp(y, 0, MAX_HEIGHT)));
	}

	public static TrafficSignShape getShapeByIndex(int index) {
		for (TrafficSignShape shape : TrafficSignShape.values()) {
			if (shape.getIndex() == index) {
				return shape;
			}
		}
		return TrafficSignShape.CIRCLE;
	}

	public DynamicTexture getShapeTexture() {
		return SHAPE_TEXTURES[this.getIndex()];
	}

	public int getShapeTextureId() {
		return this.getShapeTexture().getId();
	}

	public final ResourceLocation getIconResourceLocation() {
		return new ResourceLocation(ModMain.MOD_ID, String.format("textures/block/sign/icons/%s.png", this.getShape()));
	}

    @Override
    public String getSerializedName() {
        return shape;
    }
}
